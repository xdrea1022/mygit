<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>商品列表</title>
    <link href="css/public.css" rel="stylesheet" type="text/css">
    <link href="css/style.css" rel="stylesheet" type="text/css">
    <link href="css/list.css" rel="stylesheet" type="text/css">
</head>
<body>
    <!-- 头部工具栏 -->
    <header>
        <div class="nav">
            <div id="wrap" class="_auto">
                <ul class="left">
                    <li>欢迎光临易果生鲜！</li>
                    <li>配送至： 上海</li>
                    <li>
                        <img src="imgs/notice.png"/>
                        <a href="#">网警提示</a>
                    </li>
                </ul>
                <ul class="right">
                    <li class="_login">
                        <a href="login.html">[登录]</a>
                    </li>
                    <li class="_register">
                        <a href="register.html">[注册]</a>
                    </li>
                    <li class="myyiguo">
                        <a href="#">
                            <img src="imgs/apt.png" alt="">
                            <span>我的易果</span>
                        </a>
                    </li>
                    <li class="mobile">
                        <a href="#">
                            <img src="imgs/person.png" alt="">
                            <span>手机易果</span>
                        </a>
                    </li>
                    <li class="pay">
                        <a href="#">
                            <img src="imgs/apt.png" alt="">
                            <span>礼品卡绑定</span>
                        </a>
                    </li>
                    <li class="ent">
                        <a href="#">
                            <img src="imgs/person.png" alt="">
                            <span>礼品兑换入口</span>
                        </a>
                    </li>
                    <li class="apt">
                        <img src="imgs/apt.png" alt="">
                        <a href="">营业资质</a>
                    </li>
                    <li class="person">
                        <img src="imgs/person.png" alt="">
                        <a href="">人才招聘</a>
                    </li>
                </ul>
            </div>
            <!-- 头部 -->
            <div id="header">
                <div class="_auto header">
                    <a href="index.html" class="logo"><img src="imgs/logo.png" alt=""></a>
                    <div class="search">
                        <div class="word">
                            <input type="text" name="keyword" id="txt" value="输入商品名/编号/拼音">
                            <input type="submit" value="搜索" id="sub">
                        </div>
                        <div id="keywords">
                            <a href="#">虾仁</a>
                            <a href="#">三文鱼</a>
                            <a href="#">冰鲜牛肉</a>
                            <a href="#">刺身</a>
                            <a href="#">新西兰鹿肉</a>
                            <a href="#">鳕鱼</a>
                            <a href="#">牛腱</a>
                            <a href="#">奇异果</a>
                        </div>
                    </div>
                    <!-- 购物车 -->
                    <a class="shopping" href="shopping.html">
                        <span class="num">
                            <b>0</b>
                        </span>
                        <i>购物车</i>
                    </a>
                </div>
            </div>            
        </div>
    </header>

    <!-- 广告位 -->
    <div class="_auto page-ad">
        <img src="imgs/ad-banner.jpg" alt="">
    </div>
    <div class="page-small _auto">
        <a href="#" class="middle">
            <img src="imgs/page-middle.jpg" >
        </a>
        <a href="#" class="middle">
            <img src="imgs/page-middle1.jpg" >
        </a>
        <a href="#" class="small">
            <img src="imgs/page-small1.jpg" >
        </a>
        <a href="#" class="small">
            <img src="imgs/page-small2.jpg" >
        </a>
    </div>

    <!-- 所有分类 -->
    <div class="_auto">
        <div class="select _auto">
            <div class="tit">所有分类</div>
            <ul>
                <li>
                    <a href="#">时令水果</a>
                </li>
                <li>
                    <a href="#">芒果</a>
                </li>
                <li>
                    <a href="#">火龙果</a>
                </li>
                <li>
                    <a href="#">热带水果</a>
                </li>
                <li>
                    <a href="#">橙子</a>
                </li>
                <li>
                    <a href="#">榴莲</a>
                </li>
                <li>
                    <a href="#">椰子</a>
                </li>
                <li>
                    <a href="#">朱油果</a>
                </li>
                <li>
                    <a href="#">梅子</a>
                </li>
                <li>
                    <a href="#">李子</a>
                </li>
                <li>
                    <a href="#">苹果</a>
                </li>
                <li>
                    <a href="#">提子</a>
                </li>
                <li>
                    <a href="#">车厘子</a>
                </li>
            </ul>
        </div>
    </div>

    <!-- 排序 -->
    <div class="_auto">
        <div class="filter">
            <a href="#">默认排序</a>
            <a href="#" class="write">销量</a>
            <a href="#" class="write">价格</a>
            <a href="#" class="write">评论</a>

        </div>
    </div>

    <!-- 商品列表 -->
    <div class="_auto">
        <div class="goods_list">
            <ul id="list">
                <!-- 
                <li>
                    <a href="">
                        <img src="imgs/list-img6.jpg" alt="">
                    </a>
                    <div class="p-info">
                        <p class="p-name">
                            <a href="#">新奇士澳大利亚脐橙12个/箱180g以上/个</a>
                            <div class="p-buy">
                                <span>￥88.00</span>
                                <a href="#">加入购物车</a>
                            </div>

                        </p>
                    </div>
                </li>-->
            </ul>
        </div>
    </div>
    <!-- 分页 -->
    <div class="pagWarp" id="pageWarp">
        <li id="btnL">上一页</li>
        <ul></ul>
        <li id="btnR">下一页</li>
    </div>

    <!-- 页尾 -->
    <div class="footer-service">
        <div class="service">
            <ul class="_auto">
                <li class="s1">
                    <i></i>
                    <div class="ser">
                        <b>全球精选</b>
                        <span>一站式生鲜购物方案</span>
                    </div>
                </li>
                <li class="s2">
                    <i></i>
                    <b>多仓直发</b>
                    <span>次日达配送服务</span>
                </li>
                <li class="s3">
                    <i></i>
                    <b>品质严选</b>
                    <span>精选正宗品质好食材</span>
                </li>
                <li class="s4">
                    <i></i>
                    <b>天天低价</b>
                    <span>会员专属优惠购不停s</span>
                </li>
            </ul>
        </div>
    </div>

    <footer>
        <div class="_auto">
            <dl class="col1">
                <dt>
                    <i></i>
                    <span>新手指南</span>
                </dt>
                <dd>
                    <p>
                        <a href="#">账户祖册</a>
                    </p>
                    <p>
                        <a href="#">购物流程</a>
                    </p>
                    <p>
                        <a href="#">订购方式</a>
                    </p>
                    <p>
                        <a href="#">会员等级</a>
                    </p>
                    <p>
                        <a href="#">慧慧代码</a>
                    </p>
                </dd>
            </dl>
            <dl class="col2">
                <dt>
                    <i></i>
                    <span>新手指南</span>
                </dt>
                <dd>
                    <p>
                        <a href="#">账户祖册</a>
                    </p>
                    <p>
                        <a href="#">购物流程</a>
                    </p>
                    <p>
                        <a href="#">订购方式</a>
                    </p>
                    <p>
                        <a href="#">会员等级</a>
                    </p>
                    <p>
                        <a href="#">慧慧代码</a>
                    </p>
                </dd>
            </dl>
            <dl class="col3">
                <dt>
                    <i></i>
                    <span>新手指南</span>
                </dt>
                <dd>
                    <p>
                        <a href="#">账户祖册</a>
                    </p>
                    <p>
                        <a href="#">购物流程</a>
                    </p>
                    <p>
                        <a href="#">订购方式</a>
                    </p>
                    <p>
                        <a href="#">会员等级</a>
                    </p>
                    <p>
                        <a href="#">慧慧代码</a>
                    </p>
                </dd>
            </dl>
            <dl class="col4">
                <dt>
                    <i></i>
                    <span>新手指南</span>
                </dt>
                <dd>
                    <p>
                        <a href="#">账户祖册</a>
                    </p>
                    <p>
                        <a href="#">购物流程</a>
                    </p>
                    <p>
                        <a href="#">订购方式</a>
                    </p>
                    <p>
                        <a href="#">会员等级</a>
                    </p>
                    <p>
                        <a href="#">慧慧代码</a>
                    </p>
                </dd>
            </dl>
            <dl class="col5">
                <dt>
                    <i></i>
                    <span>新手指南</span>
                </dt>
                <dd>
                    <p>
                        <a href="#">账户祖册</a>
                    </p>
                    <p>
                        <a href="#">购物流程</a>
                    </p>
                    <p>
                        <a href="#">订购方式</a>
                    </p>
                    <p>
                        <a href="#">会员等级</a>
                    </p>
                    <p>
                        <a href="#">慧慧代码</a>
                    </p>
                </dd>
            </dl>
            <div class="tel">
                <span>客服热线 400-000-7788 企业采购或团购，请转2号键咨询</span>
                <span>周一至周日 9:00-21:00</span>
            </div>
            <div class="copyright">
                <p>所有图片均受著作权保护，未经许可任何单位与个人不得使用、复制、转载、摘编，违者必究法律责任。</p>
                <p>沪ICP备09008015号   Copyright © 2005-2019  版权所有</p>
                <p class="friends">
                    <a href="#">
                        <img src="imgs/ordermeal.png" alt="">
                    </a>
                    <a href="#">
                        <img src="imgs/report.png" alt="">
                    </a>
                    <a href="#">
                        <img src="imgs/wxb.png" alt="">
                    </a>
                    <a href="#">
                        <img src="imgs/tu6.png">
                    </a>
                    <a href="#">
                        <img src="imgs/tu3.png" alt="">
                    </a>
                    <a href="#">
                        <img src="imgs/footer_copy.jpg" alt="">
                    </a>
                    <a href="#">沪公网安备 31010502000002号</a>
                </p>
                <p>违法和不良信息举报电话 400-000-7788</p>
            </div>

        </div>

    </footer>
</body>
<script src="data/js/ajax.js"></script>
<script src="data/js/cookie.js"></script>
<!-- <script src="data/js/list.js"></script> -->
<script>
    class Page{
    constructor(options){
        // 构造函数 将传入的数据加给实例
        this.url = options.url;
        this.left = options.left;
        this.right = options.right;
        this.list = options.list;
        this.pageCont = options.pageCont;
        // 如果没有传，就默认第一页
        this.index =options.index || 0;
        // 如果没有传就默认一页显示3个数据
        this.num = options.num || 3;
        // 1.开始请求数据
        this.load();
        // 4.绑定事件
        this.addEvent();
        this.addEvent1();
    }
    load(){
        // 将this提前存入that中，方便后面使用
        var that =this;
        // 1.开始请求数据
        ajaxGet(this.url,function(res){
            // 将传入的json文件转换为对象，赋值给实例上的res上
            that.res = JSON.parse(res);
            // 2.请求数据是开始渲染结构
            that.display();
            // 3.请求数据时开始渲染页码
            that.createPage();
        })
    }
    // 开始渲染结构
    display(){
        // 用字符拼接来渲染结构
        var str = "";
        // 实现每页显示的数据是num条
        for(var i=this.index*this.num;i<(this.index+1)*this.num;i++){
            // 判断当前i是否小于传入的对象的长度 （(this.index+1)*this.num这个公式会让i变很大）
            if(i<this.res.length){
                // 拼接字符串
                str += `<li index="${this.res[i].goodsId}">
                <div>
                    <img src="${this.res[i].url}" alt="">
                </div>
                <div class="p-info">
                    <p class="p-name">
                        <a>${this.res[i].name}</a>
                        <div class="p-buy">
                            <span>￥${this.res[i].price}</span>
                            <div class="addCar">加入购物车</div>
                        </div>

                    </p>
                </div>
            </li>`
            }
        }
        // 在id为list的标签中插入拼接好的数据
        this.list.innerHTML = str;
    }
    // 3.操作渲染页面
    createPage(){
        // 计算一共有多少页，对对象的长度向上取整，除以每页显示的个数，为最终页码数
        this.maxNum = Math.ceil(this.res.length / this.num);
        // 将1-maxNum之间所有的页面遍历出来，给id为pageWarp的标签里创建能显示页面的标签
        var str = "";
        for(var i = 0;i<this.maxNum;i++){
            str += `<li>${i+1}</li>`;
        }
        this.pageCont.innerHTML = str;
        // 5.开始设置当前页码的标签className为active，根据索引显示当前
        this.setActive();
    }
    setActive(){
        // 遍历id为pageWarp标签下所有的子元素
        for(var i = 0 ;i<this.pageCont.children.length;i++){
            // 清空所有子元素的className
            this.pageCont.children[i].className = "";
        }
        // 赋值当前的页码的className为active
        this.pageCont.children[this.index].className = "active";
    }
    // 加事件
    addEvent(){
        var that = this ;
        this.right.onclick = function(){
            // 5.点击时要显示的索引
            that.changeIndexR();
        }
        this.left.onclick = function(){
            that.changeIndexL();
        }
    }
    changeIndexR(){
        if(this.index == this.maxNum-1){
            this.index = 0;
        }else{
            this.index++;
        }
        // 6.重新渲染结构
        this.display();
        // 创建当前点击的标签的className为active，来实现样式的改变
        this.setActive();
    }
    changeIndexL(){
        if(this.index == 0){
            this.index = this.maxNum-1;
        }else{
            this.index--;
        }
        this.display();
        // 创建当前点击的标签的className为active，来实现样式的改变
        this.setActive();
    }
    addEvent1(){
        var that=this;
        this.list.addEventListener("click",function(eve){
            var e=eve||window.event;
            var target=e.target||e.srcElement;
            if(target.className=="addCar"){
                that.id=target.parentNode.parentNode.parentNode.getAttribute("index");  //给该构造函数添加一个可变的属性保存点击的事件id
                that.setCookie();
            }
        })
    }
    setCookie(){
     this.goods= getCookie("goods")?JSON.parse(getCookie("goods")):[];
     if(this.goods.length<1){
         this.goods.push({id:this.id,num:1})
     }else{
         var off=true;
        //  console.log(this.id);

        //  for(var i=0;i<this.goods.length;i++){
        //      if(this.goods[i].id==this.id){
        //          this.goods[i].num++;
        //          off=false;
        //      }
        //  }
        var i=0;
        var off= this.goods.some((value,index)=>{
            i=index;
            return value.id==this.id;
        });
         if(off){
             this.goods[i].num++;
         }else{
            this.goods.push({id:this.id,num:1});
         }
     }
     setCookie("goods",JSON.stringify(this.goods),{expires:7});
    }
}

new Page({
    url:"data/goods.json",
    left:document.getElementById("btnL"),
    right:document.getElementById("btnR"),
    list:document.getElementById("list"),
    pageCont:document.querySelector("#pageWarp ul"),
    index:0,
    num:8
})
</script>
</html>